<mxfile host="app.diagrams.net" modified="2021-12-06T06:00:43.402Z" agent="5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36" etag="F9toikWnqBe5pji9veFF" version="15.8.8" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="1350" dy="773" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="-dofhX7ysMKLdWdlOMmF-4" value="&lt;span style=&quot;font-size: 20px&quot;&gt;&lt;font style=&quot;vertical-align: inherit&quot;&gt;&lt;font style=&quot;vertical-align: inherit&quot;&gt;imu 视觉信息输入&lt;/font&gt;&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="40" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-dofhX7ysMKLdWdlOMmF-5" value="&lt;font style=&quot;vertical-align: inherit&quot;&gt;&lt;font style=&quot;vertical-align: inherit&quot;&gt;&lt;font style=&quot;vertical-align: inherit&quot;&gt;&lt;font style=&quot;vertical-align: inherit ; font-size: 12px&quot;&gt;imu 信息&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="90" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-0" value="fisheye 信息" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-1" value="&lt;font style=&quot;font-size: 20px&quot;&gt;tracking 线程&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="349" y="30" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-2" value="&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;std::list&amp;lt;IMU::Point&amp;gt; mlQueueImuData1;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;std::list&amp;lt;IMU::Point&amp;gt; mlQueueImuData2;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;保存输入的imu数据&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;mlQueueImuData1 用来进行实时的积分&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;mlQueueImuData2 用来对保存原始数据，对新的视觉数据进行对齐&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="220" y="74" width="440" height="160" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-3" value="&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;std::list&amp;lt;std::pair&amp;lt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34;&quot;&gt;cv&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34;&quot;&gt;::Mat lIm,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;cv&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;::Mat rIm&amp;gt;&lt;/span&gt;&amp;gt; mlQueueImageData;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;保存输入的fisheye数据&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="218" y="212" width="550" height="40" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-4" value="当前imu信息处理的流程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="10" y="320" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-6" value="&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;PreintegrateIMU视觉线程中预积分是否可以不用再次积分了&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;，先选择积分，但是在这个函数中不能直接用&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;mlQueueImuData 容器&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;需要通过时间戳进行选择时间。自己有选择，暂时可以不考虑&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="200" y="350" width="450" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-7" value="imu数据处理线程" style="whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="670" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-9" value="视觉数据处理线程" style="whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="20" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="GGLkbrjlZim7dI6dOB1Z-10" value="&lt;div style=&quot;text-align: justify ; font-size: 12px&quot;&gt;&lt;span&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;pImuPreintegrated = new IMU::Preintegrated(IMU::Bias(),*mpImuCalib);&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;// 每一次处理图像时会重新启动一个imu预积分的容器。&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;在跟踪完成之后，这个容器是给下一次imu的数据预积分时使用的。&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;所以，可以在这里对于Imu的预积分信息不是单纯的初始化，而是查看时间戳的信息，&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;如果当前预积分imu的时间戳超过当前图像时间戳，&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;这里可以预积分一部分超过的imu数据。同时在这个可以对临时保存的imu信息进行管理&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontColor=#000000;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="165" y="445" width="470" height="160" as="geometry" />
        </mxCell>
        <mxCell id="JiqzlVzhAhWz6GvbeJA0-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="JiqzlVzhAhWz6GvbeJA0-0" target="JiqzlVzhAhWz6GvbeJA0-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="JiqzlVzhAhWz6GvbeJA0-0" value="视觉数据输入和保存" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="30" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JiqzlVzhAhWz6GvbeJA0-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="JiqzlVzhAhWz6GvbeJA0-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JiqzlVzhAhWz6GvbeJA0-1" value="&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;setFisheyeDate&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="230" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JiqzlVzhAhWz6GvbeJA0-5" value="&lt;div style=&quot;font-size: 14px ; line-height: 19px ; font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34;&quot;&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 数据保存相关的锁&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::mutex mMutexImQueue&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 保存左右图像的容器&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::list&amp;lt;std::pair&amp;lt;cv::Mat lIm, cv::Mat rIm&amp;gt;&amp;gt; mlQueueImageData&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 保存图像时间戳的容器&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::list&amp;lt;double&amp;gt; mlQueueImageStamptime&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 保存图像名字的容器&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::list&amp;lt;std::string&amp;gt; filenames&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 处理图像线程唤醒的变量&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::condition_variable m_cv_image&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;// 没有数据时，线程休眠的锁&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;std::mutex&amp;nbsp;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;m_image_mutex&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; text-align: center&quot;&gt;// 图像处理的线程&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;std::thread m_run_thread;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;// 线程结束标志&lt;/div&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;std::atomic&amp;lt;bool&amp;gt; m_shutdown;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , &amp;#34;monospace&amp;#34; , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#000000;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="479" y="600" width="550" height="330" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
